#!/bin/bash -ex

    #Switch1 rules
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10000 -j DNAT --to-destination 192.168.121.109:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.109 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.109 -j SNAT --to-source 10.17.161.200

    #Switch2 rules
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10001 -j DNAT --to-destination 192.168.121.55:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.55 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.55 -j SNAT --to-source 10.17.161.200

    #Switch3 rules
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10002 -j DNAT --to-destination 192.168.121.138:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.138 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.138 -j SNAT --to-source 10.17.161.200

    #Switch4 rules
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10003 -j DNAT --to-destination 192.168.121.18:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.18 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.18 -j SNAT --to-source 10.17.161.200

    #Switch5 rules
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10004 -j DNAT --to-destination 192.168.121.76:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.76 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.76 -j SNAT --to-source 10.17.161.200
