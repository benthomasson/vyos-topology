#!/bin/bash -ex

    #leaf00 rules
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10100 -j DNAT --to-destination 192.168.121.98:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.98 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.98 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10100 -j DNAT --to-destination 192.168.121.98:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.98 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.98 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10100 -j DNAT --to-destination 192.168.121.98:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.98 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.98 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10100 -j DNAT --to-destination 192.168.121.98:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.98 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.98 -j SNAT --to-source 10.17.161.200
    

    #leaf01 rules
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10101 -j DNAT --to-destination 192.168.121.33:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.33 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.33 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10101 -j DNAT --to-destination 192.168.121.33:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.33 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.33 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10101 -j DNAT --to-destination 192.168.121.33:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.33 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.33 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10101 -j DNAT --to-destination 192.168.121.33:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.33 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.33 -j SNAT --to-source 10.17.161.200
    

    #server00 rules
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10102 -j DNAT --to-destination 192.168.121.232:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.232 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.232 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10102 -j DNAT --to-destination 192.168.121.232:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.232 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.232 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10102 -j DNAT --to-destination 192.168.121.232:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.232 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.232 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10102 -j DNAT --to-destination 192.168.121.232:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.232 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.232 -j SNAT --to-source 10.17.161.200
    

    #server01 rules
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10103 -j DNAT --to-destination 192.168.121.15:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.15 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.15 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10103 -j DNAT --to-destination 192.168.121.15:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.15 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.15 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10103 -j DNAT --to-destination 192.168.121.15:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.15 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.15 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10103 -j DNAT --to-destination 192.168.121.15:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.15 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.15 -j SNAT --to-source 10.17.161.200
    

    #spine00 rules
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10104 -j DNAT --to-destination 192.168.121.207:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.207 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.207 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10104 -j DNAT --to-destination 192.168.121.207:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.207 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.207 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10104 -j DNAT --to-destination 192.168.121.207:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.207 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.207 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10104 -j DNAT --to-destination 192.168.121.207:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.207 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.207 -j SNAT --to-source 10.17.161.200
    

    #spine01 rules
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10105 -j DNAT --to-destination 192.168.121.245:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.245 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.245 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10105 -j DNAT --to-destination 192.168.121.245:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.245 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.245 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10105 -j DNAT --to-destination 192.168.121.245:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.245 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.245 -j SNAT --to-source 10.17.161.200
    
    sudo iptables -t nat -I PREROUTING 1 -d 10.17.161.200 -p tcp --dport 10105 -j DNAT --to-destination 192.168.121.245:22
    sudo iptables -I FORWARD 1 -p tcp -d 192.168.121.245 --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
    sudo iptables -t nat -I POSTROUTING 1 -s 192.168.121.245 -j SNAT --to-source 10.17.161.200
    
